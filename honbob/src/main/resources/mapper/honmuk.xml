<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- Mybatis 사용 -->
<mapper namespace="Honmuk">
	<select id="searchList" parameterType="vo.RestaurantVO" resultType="vo.RestaurantVO">
		select * from restaurantvo
		<where>
			<if test="keyword != null">
				res_name like '%${keyword}%' or address like '%${keyword}%'
			</if>
		
			<if test="koreafood == 1">
				koreafood='1'
			</if>
			<if test="japanfood == 1">
				 or japanfood='1'
			</if>
			<if test="westernfood == 1">
				 or westernfood='1'
			</if>
			<if test="chinafood == 1">
				 or chinafood='1'
			</if>
			<if test="etcfood == 1">
				 or etcfood='1' 
			</if>		 
		 
			<if test="drink == 1">
				 or drink='1' 
			</if>
			<if test="partition2 == 1">
				 or partition2='1' 
			</if>
			<if test="calculator == 1">
				 or calculator='1' 
			</if>
			<if test="park == 1">
				 or park='1' 
			</if>
			<if test="table2 == 1">
				 or table2='1' 
			</if>
		</where>		
		
		<if test="grade == 1">
			order by grade desc
		</if>
		<if test="readcount == 1">
			order by readcount desc
		</if>
		<if test="reviewcount == 1">
			order by reviewcount desc
		</if>
		
		limit #{startIndex}, #{limit};
	</select>
		
	<select id="searchCount" resultType="int">
		select count(*) from restaurantvo;
	</select>
	<!-- 전체 식당 리스트 불러오기 -->
	<select id="getList" resultType="vo.RestaurantVO">
		select * from restaurant;
	</select>
	<!-- id로 식당 정보 가져오기 -->
	<select id="getRestaurantById" parameterType="Integer" resultType="vo.RestaurantVO">
		select * from restaurant where res_num=#{res_num}
	</select>
	<!-- 식당 번호로 식당사진 불러오기 -->
	<select id ="getImage" resultType="vo.RestaurantImageVO" parameterType="Integer">
		select * from restaurantImage where res_num=#{res_num}
	</select>
	<!-- 식당 대표 사진 불러오기 -->
	<select id ="getBestImage" resultType="vo.RestaurantImageVO" parameterType="Integer">
		select * from restaurantImage where best_image=1 and res_num=#{res_num}
	</select>
	<!-- imageDB 등록 -->
	<insert id="registImageVO" parameterType="vo.RestaurantImageVO">
		insert into restaurantImage(res_image_num,res_num,best_image,res_image_name)
							values(#{res_image_num},#{res_num},#{best_image},#{res_image_name})
	</insert>
	<!-- 조회수 올리기 -->
	<update id="upViewCount" parameterType="Integer">
		update restaurant set readcount = readcount+1 where res_num=#{res_num}
	</update>
	<!-- 별점 합가져오기 -->
	<select id="getGradeSum" resultType="Integer">
		select sum(grade) from grade where res_num=#{res_num}
	</select>
	<!-- 별점한 사람 수 가져오기 -->
	<select id="getGradeCnt" resultType="Integer">
		select count(grade) from grade where res_num=#{res_num}
	</select>
	<!-- 추천식당 가져오기 -->
	<select id="getRecommandRestaurant" parameterType="vo.RestaurantVO" resultType="vo.RestaurantVO">
		select * from restaurant 
		<where> 
			<if test="koreafood == 1">
				koreafood='1'
			</if>
			<if test="japanfood == 1">
				 or japanfood='1'
			</if>
			<if test="westernfood == 1">
				 or westernfood='1'
			</if>
			<if test="chinafood == 1">
				 or chinafood='1'
			</if>
			<if test="etcfood == 1">
				 or etcfood='1' 
			</if>
		</where>
		order by readcount desc limit 3
	</select>
	<!-- 유저가 별점을 했는지 찾아본다 -->
	<select id="getUserGrade" parameterType="vo.GradeVO" resultType="Integer">
		select grade from grade where res_num=#{res_num} and userNo = #{userNo}
	</select>
	<!-- insertGrade -->
	<insert id="insertGrade" parameterType="vo.GradeVO">
		insert into grade(res_num,userNo,grade) values (#{res_num},#{userNo},#{grade})
	</insert>
	<!-- updateGrade -->
	<update id="updateGrade" parameterType="vo.GradeVO">
		update grade set grade = #{grade} where res_num=#{res_num} and userNo = #{userNo}
	</update>
	<!-- deleteGrade -->
	<delete id="deleteGrade" parameterType="vo.GradeVO">
		delete from grade
		where res_num=#{res_num} and userNo = #{userNo}
	</delete>
	<!-- 리뷰 리스트 가져오기 -->
	
	<!-- 메인페이지에서 최신리뷰 6개 가져오기 -->
	<select id="mainpageReview" resultType="vo.review.ReviewVO" parameterType="vo.review.ReviewVO">
			SELECT * FROM project.review WHERE registdate LIMIT 0,6
	</select>
	
</mapper>
